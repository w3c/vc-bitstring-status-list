<!DOCTYPE html>
<html>
  <head>
    <title>Bitstring Status List v1.0</title>
    <meta http-equiv='Content-Type' content='text/html;charset=utf-8'/>
    <!--
      === NOTA BENE ===
      For the three scripts below, if your spec resides on dev.w3 you can check them
      out in the same tree and use relative links so that they'll work offline,
     -->
    <script src='https://www.w3.org/Tools/respec/respec-w3c' class='remove'></script>
    <script src="./common.js" class="remove"></script>
    <script class="remove"
      src="https://cdn.jsdelivr.net/gh/digitalbazaar/respec-vc@2.0.1/dist/main.js"></script>
    <script type="text/javascript" class="remove">
      var respecConfig = {
        // specification status (e.g., WD, LCWD, NOTE, etc.). If in doubt use ED.
        specStatus: "ED",
        group: "vc",

        // the specification's short name, as in http://www.w3.org/TR/short-name/
        shortName: "vc-bitstring-status-list",

        // subtitle for the spec
        subtitle: "Privacy-preserving status information for Verifiable Credentials",

        // if you wish the publication date to be other than today, set this
        //publishDate: "2023-04-27",
        //crEnd: "2019-04-23",
        //implementationReportURI: "https://w3c.github.io/sdh-test-suite",
        //previousMaturity: "CG-FINAL",
        //previousPublishDate: "2021-03-18",

        // if there is a previously published draft, uncomment this and set its YYYY-MM-DD date
        // and its maturity status
        // previousPublishDate:  "1977-03-15",
        // previousMaturity:  "WD",

        // extend the bibliography entries
        localBiblio: ccg.localBiblio,
        doJsonLd: true,

        github: "https://github.com/w3c/vc-bitstring-status-list",
        includePermalinks: false,

        // if there a publicly available Editor's Draft, this is the link
        edDraftURI: "https://w3c.github.io/vc-bitstring-status-list/",

        // if this is a LCWD, uncomment and set the end of its review period
        // lcEnd: "2009-08-05",

        // editors, add as many as you like
        // only "name" is required
        editors: [{
          name: "Manu Sporny",
          url: "http://manu.sporny.org/",
          company: "Digital Bazaar",
          companyURL: "https://www.digitalbazaar.com/",
          w3cid: 41758
        }, {
          name: "Dave Longley",
          url: "https://github.com/dlongley",
          company: "Digital Bazaar",
          companyURL: "https://www.digitalbazaar.com/",
          w3cid: 48025
        }, {
          name: 'Mike Prorock',
          url: 'https://mesur.io/',
          company: 'mesur.io',
          companyURL: 'https://mesur.io/',
          w3cid: 130636
        }, {
          name: 'Mahmoud Alkhraishi',
          url: 'https://github.com/mkhraisha',
          company: 'Mavennet',
          companyURL: 'https://www.mavennet.com/',
          w3cid: 121911
        }],
        // authors, add as many as you like.
        // This is optional, uncomment if you have authors as well as editors.
        // only "name" is required. Same format as editors.
        authors: [{
          name: "Dave Longley",
          url: "https://github.com/dlongley",
          company: "Digital Bazaar",
          companyURL: "https://www.digitalbazaar.com/",
          w3cid: 48025
        }, {
          name: "Manu Sporny",
          url: "http://manu.sporny.org/",
          company: "Digital Bazaar",
          companyURL: "https://www.digitalbazaar.com/",
          w3cid: 41758
        }, {
          name: 'Orie Steele',
          url: 'https://github.com/OR13',
          company: 'Transmute',
          companyURL: 'https://transmute.industries/',
          w3cid: 109171
        }],
        // turn off unused defns warning since we have restrictRefs
        lint: {
          "no-unused-dfns": false
        },

        // post process
        postProcess: [restrictRefs, window.respecVc.createVcExamples],

        // URI of the patent status for this WG, for Rec-track documents
        // !!!! IMPORTANT !!!!
        // This is important for Rec-track documents, do not copy a patent URI from a random
        // document unless you know what you're doing. If in doubt ask your friendly neighborhood
        // Team Contact.
        //wgPatentURI:  "https://www.w3.org/2004/01/pp-impl/98922/status",
        maxTocLevel: 2,
        inlineCSS: true,
        otherLinks: [{
          key: "Related Documents",
          data: [{
            value: "Verifiable Credentials Data Model",
            href: "https://www.w3.org/TR/vc-data-model-2.0/"
          }]
        }]
      };
    </script>
    <style>
code {
  color: rgb(199, 73, 0);
  font-weight: bold;
}
pre {
  overflow-x: auto;
  white-space: pre-wrap;
}
pre .highlight {
  font-weight: bold;
  color: Green;
}
pre .subject {
  font-weight: bold;
  color: RoyalBlue;
}
pre .property {
  font-weight: bold;
  color: DarkGoldenrod;
}
pre .comment {
  font-weight: bold;
  color: SteelBlue;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
.color-text {
  font-weight: bold;
  text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;
}
ol.algorithm {
  counter-reset: numsection;
  list-style-type: none;
}
ol.algorithm li {
  margin: 0.5em 0;
}
ol.algorithm li:before {
  font-weight: bold;
  counter-increment: numsection;
  content: counters(numsection, ".") ") ";
}
    </style>
  </head>
  <body>
    <section id='abstract'>
      <p>
This specification describes a privacy-preserving, space-efficient, and
high-performance mechanism for publishing status information such as
suspension or revocation of Verifiable Credentials through use of bitstrings.
      </p>
    </section>

    <section id='sotd'></section>

    <section class="informative">
      <h2>Introduction</h2>
      <p>
It is often useful for an <a>issuer</a> of <a>verifiable credentials</a>
[[VC-DATA-MODEL-2.0]] to link to a location where a <a>verifier</a> can check to see
if a credential has been suspended or revoked. There are a variety of privacy
and performance considerations that are made when designing, publishing, and
processing status lists.
      </p>
      <p>
One such privacy consideration happens when there is a one-to-one mapping
between a <a>verifiable credential</a> and a URL where the status is
published. This type of mapping enables the website that publishes the URL to
correlate the <a>holder</a>, time, and <a>verifier</a> when the status is
checked. This could enable the <a>issuer</a> to discover the type of interaction
the <a>holder</a> is having with the <a>verifier</a>, such as providing an age
verification credential when entering a bar. Being tracked by the <a>issuer</a>
of a driver's license when entering an establishment violates a privacy
expectation that many people have today.
      </p>
      <p>
Similarly, there are performance considerations that are explored when designing
status lists. One such consideration is where the list is published and the
burden it places from a bandwidth and processing perspective, both on the server
and the client fetching the information. In order to meet privacy expectations,
it is useful to bundle the status of large sets of credentials into a single
list to help with herd privacy. However, doing so can place an impossible
burden on both the server and client if the status information is as much as a
few hundred bytes in size per credential across a population of
hundreds of millions of <a>holders</a>.
      </p>
      <p>
The rest of this document proposes a highly compressible, bitstring-based
status list mechanism with strong privacy-preserving characteristics,
that is compatible with the architecture of the Web, is highly space-efficient,
and lends itself well to content distribution networks. As an example of
using this specification to achieve a number of beneficial privacy and
performance goals, it is possible to create a status list that can be
constructed for 100,000 <a>verifiable credentials</a> that is roughly
12,500 bytes in size in the worst case. In a case where a few hundred
credentials have been revoked, the size of the list is less than a
few hundred bytes while providing privacy in a herd of 100,000 individuals.
      </p>

      <section class="informative">
        <h3>Conceptual Framework</h3>

        <p>
This section outlines the core concept utilized by the status list
mechanism described in this specification. At the most basic level, status
information for all <a>verifiable credentials</a> issued by an <a>issuer</a>
is expressed as items in a list. Each <a>issuer</a> manages a list
of all <a>verifiable credentials</a> that it has issued. Each
<a>verifiable credential</a> is associated with an item in its list.
When a single bit specifies a status, such as "revoked" or "suspended",
then that status is expected to be true when the bit is set (`1`) and
false when unset (`0`).
        </p>

        <p>
One of the benefits of using a bitstring is that it is a highly compressible
data format since, in the average case, large numbers of credentials will
remain unrevoked. This will ensure long sections of bits that are the same
value and thus highly compressible using run-length compression techniques
such as GZIP [[RFC1952]]. The default status list size is 131,072 entries,
equivalent to 16&nbsp;KB of single bit values. When only a handful of
<a>verifiable credentials</a> are revoked, GZIP compresses the bitstring
to a few hundred bytes.
        </p>

        <p>
Another benefit of using a bitstring is that it enables large numbers of
<a>verifiable credential</a> statuses to be placed in the same list.
This specification uses a minimum list length of 131,072. This
size ensures an adequate amount of herd privacy in the average case.
If better herd privacy is required, the bitstring can be made larger.
        </p>

        <figure id="bitstring">
          <img style="margin: auto; display: block; width: 75%;"
               src="diagrams/StatusList2021.svg" alt="diagram showing a
               list of boxes at the top of the image with two of them in
               red depicting revoked credentials. Text beside the boxes to the
               right reads 16 kilobytes. An depiction of the boxes being
               GZIP compressed into a cylinder on the bottom of the page shows
               that compression has resulted in a final size of 135 bytes.">
          <figcaption style="text-align: center;">
            A visual depiction of the concepts outlined in this section.
          </figcaption>
        </figure>

        <p class="note"
           title="Status information is about the verifiable credential">
The status information associated with a particular <a>verifiable credential</a>
is about the <a>verifiable credential</a> itself and might not apply to any
underlying or backing <a>credential</a>, such as an educational degree. For
example, in the case of such an educational degree, it is possible for a
<a>verifiable credential</a> to be revoked because the mechanism used to
create its digital signature has been compromised, while the backing educational
degree remains valid.
        </p>

      </section>

      <section class="informative">
        <h3>Terminology</h3>

        <div data-include="https://w3c.github.io/vc-data-model/terms.html"></div>
      </section>

      <section id="conformance" class="normative">

        <p>
A <dfn>conforming document</dfn> is any concrete expression of the
data model that follows the relevant normative requirements in Section
<a href="#data-model"></a>.
        </p>

        <p>
A <dfn>conforming processor</dfn> is any algorithm realized
as software and/or hardware that generates and/or consumes a
<a>conforming document</a> according to the relevant normative statements in
Section <a href="#algorithms"></a>. Conforming processors MUST produce errors
when non-conforming documents are consumed.
        </p>

      </section>

    </section>

    <section class="normative">
      <h2>Data Model</h2>

      <p>
The following sections outline the data model for this document.
      </p>

      <section>
        <h3>BitstringStatusListEntry</h3>

        <p>
When an <a>issuer</a> desires to enable status information for a
<a>verifiable credential</a>, they MAY add a `credentialStatus`
property that uses the data model described in this section. Any
expression of the data model in this section MUST be expressed in a
conforming <a>verifiable credential</a> as defined in [[VC-DATA-MODEL-2.0]].
        </p>

        <table class="simple">
          <thead>
            <tr>
              <th style="white-space: nowrap">Property</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>id</td>
              <td>
An optional identifier for the status list entry. The constraints on the `id`
property are listed in the Verifiable Credentials Data Model specification
[[VC-DATA-MODEL-2.0]]. If present, the value is expected to be a URL that
identifies the status information associated with the <a>verifiable
credential</a>. It MUST NOT be the URL for the status list. The value is not
used during the verification or validation process, and does not need to be
related to the `statusListCredential` value. If necessary, the value can be used
to uniquely identify the `BitstringStatusListEntry` object, such as when it is
stored in a database.
              </td>
            </tr>
            <tr>
              <td>type</td>
              <td>
The `type` property MUST be `BitstringStatusListEntry`.
              </td>
            </tr>
            <tr>
              <td>statusPurpose</td>
              <td>
The purpose of the status entry MUST be a string. While the value of the
string is arbitrary, the following values MUST be used for their intended
purpose:
                <table class="simple">
                  <thead>
                    <tr>
                      <th style="white-space: nowrap">Value</th>
                      <th>Description</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>`revocation`</td>
                      <td>
Used to cancel the validity of a <a>verifiable credential</a>. This status is
not reversible.
                      </td>
                    </tr>
                    <tr>
                      <td>`suspension`</td>
                      <td>
Used to temporarily prevent the acceptance of a <a>verifiable credential</a>.
This status is reversible.
                      </td>
                    </tr>
                    <tr>
                      <td>`message`</td>
                      <td>
Used to convey an arbitrary message related to the status of the
<a>verifiable credential</a>.
                      </td>
                    </tr>
                  </tbody>
                </table>
              </td>
            </tr>
            <tr>
              <td>statusListIndex</td>
              <td>
The `statusListIndex` property MUST be an arbitrary size integer
greater than or equal to 0, expressed as a string. The value identifies the
position of the status of the <a>verifiable credential</a>.
              </td>
            </tr>
            <tr>
              <td>statusListCredential</td>
              <td>
The `statusListCredential` property MUST be a URL to a
<a>verifiable credential</a>. When the URL is dereferenced, the resulting
<a>verifiable credential</a> MUST have `type` property that
includes the `BitstringStatusListCredential` value.
              </td>
            </tr>
          </tbody>
        </table>

        <pre class="example nohighlight" title="Example StatusListCredential">
{
  "@context": [
    "https://www.w3.org/ns/credentials/v2"
  ],
  "id": "https://example.com/credentials/23894672394",
  "type": ["VerifiableCredential"],
  "issuer": "did:example:12345",
  "validFrom": "2021-04-05T14:27:42Z",
  <span class="highlight">"credentialStatus": [
    {
      "id": "https://example.com/credentials/status/3#94567",
      "type": "BitstringStatusListEntry",
      "statusPurpose": "revocation",
      "statusListIndex": "94567",
      "statusListCredential": "https://example.com/credentials/status/3"
    }, {
      "id": "https://example.com/credentials/status/4#23452",
      "type": "BitstringStatusListEntry",
      "statusPurpose": "suspension",
      "statusListIndex": "23452",
      "statusListCredential": "https://example.com/credentials/status/4"
    }
  ]</span>,
  "credentialSubject": {
    "id": "did:example:6789",
    "type": "Person"
  },
  "proof": { <span class="comment">...</span> }
}
        </pre>
      </section>

      <section>
        <h3>BitstringStatusListCredential</h3>

        <p>
When a status list <a>verifiable credential</a> is published, it MUST be a
conforming document, as defined in [[VC-DATA-MODEL-2.0]], that expresses the
data model in this section. The following section describes the format of
the <a>verifiable credential</a> that encapsulates the status list:
        </p>

        <table class="simple">
          <thead>
            <tr>
              <th style="white-space: nowrap">Property</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>id</td>
              <td>
The <a>verifiable credential</a> that contains the status list MAY
express an `id` property that matches the value specified in
`statusListCredential` for the corresponding
`BitstringStatusListEntry` (see <a href="#bitstringstatuslistentry"></a>).
              </td>
            </tr>
            <tr>
              <td>type</td>
              <td>
The <a>verifiable credential</a> that contains the status list MUST
express a `type` property that includes the
`BitstringStatusListCredential` value.
              </td>
            </tr>
            <tr>
              <td>validFrom</td>
              <td>
The earliest point in time at which the status list is valid. This property is
defined in the Verifiable Credentials Data Model specification in
<a href="https://www.w3.org/TR/vc-data-model-2.0/#validity-period">
Section 4.6: Validity Period</a>.
              </td>
            </tr>
            <tr>
              <td>validUntil</td>
              <td>
The latest point in time at which the status list is valid. This property is
defined in the Verifiable Credentials Data Model specification in
<a href="https://www.w3.org/TR/vc-data-model-2.0/#validity-period">
Section 4.6: Validity Period</a>.
              </td>
            </tr>
            <tr>
              <td>credentialSubject.type</td>
              <td id="BitstringStatusList">
The `type` of the credential <a>subject</a>, which is the
status list, MUST be `BitstringStatusList`.
              </td>
            </tr>
            <tr>
              <td id="statusPurpose">credentialSubject.statusPurpose</td>
              <td>
The purpose of the status entry MUST be a string. While the value of the
string is arbitrary, the following values MUST be used for their intended
purpose:
                <table class="simple">
                  <thead>
                    <tr>
                      <th style="white-space: nowrap">Value</th>
                      <th>Description</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>`revocation`</td>
                      <td>
Used to cancel the validity of a <a>verifiable credential</a>. This status is
not reversible.
                      </td>
                    </tr>
                    <tr>
                      <td>`suspension`</td>
                      <td>
Used to temporarily prevent the acceptance of a <a>verifiable credential</a>.
This status is reversible.
                      </td>
                    </tr>
                    <tr>
                      <td>`message`</td>
                      <td>
Used to indicate a status message associated with a <a>verifiable
credential</a>. The status message descriptions MUST be defined in
`credentialSubject.statusMessages`. `credentialSubject.statusSize` MUST be
specified when this `statusPurpose` value is used.
                      </td>
                    </tr>
                  </tbody>
                </table>
              </td>
            </tr>
            <tr>
              <td id="encodedList">credentialSubject.encodedList</td>
              <td>
The `encodedList` property of the credential <a>subject</a> MUST be
the GZIP-compressed [[RFC1952]], base64url-encoded (with no padding) [[RFC4648]] bitstring values
for the associated range of <a>verifiable credential</a> status values. The
uncompressed bitstring MUST be at least 16KB in size. The bitstring MUST be
encoded such that the first index, with a value of zero
(`0`), is located at the left-most bit in the bitstring and the
last index, with a value of one less than the length of the bitstring
(`bitstring_length - 1`), is located at the right-most bit in the
bitstring. Further information on bitstring encoding can be found in Section
<a href="#bitstring-encoding"></a>.
              </td>
            </tr>
            <tr>
              <td id="ttl">credentialSubject.ttl</td>
              <td>
The `ttl` indicates the "time to live" in milliseconds. This property MAY be
present. If not present, implementers MUST use a value of `300000` for this
property.  A verifier MUST NOT use a cached `BitstringStatusListCredential` that
was cached for more than the `ttl` duration prior to the start of verification
operation on a <a>verifiable credential</a>. Implementations that publish the
status list SHOULD align any protocol-specific caching information, such as the
HTTP `Cache-Control` header, with the value in this field.
              </td>
            </tr>
            <tr>
              <td id="statusSize">credentialSubject.statusSize</td>
              <td>
The `statusSize` indicates the size of the status entry in bits. `statusSize`
MAY be provided. If `statusSize` is not present as a property of the
`credentialStatus`, then `statusSize` MUST be processed as `1`.  `statusSize`
MUST be an integer greater than zero. If `statusSize` is provided and is greater
than `1`, then the property `credentialStatus.statusMessage` MUST be present,
and the number of status messages must equal the number of possible values.
              </td>
            </tr>
            <tr>
              <td id="statusMessage">credentialSubject.statusMessage</td>
              <td>
The `statusMessage` property MUST be an array. If present,
the length of the array must equal the number of possible status states
indicated by `statusSize`. `statusMessages` MAY be present if
`statusSize` is `1`. `statusMessages` MUST be present if
`statusSize` is greater than `1`.  If not present, the message value
associated with the bit value of `0` is "unset" and the bit
value of `1` is "set".
If present, elements in the `statusMessage` array MUST contain at
minimum two properties:
                <ul>
                  <li id="status">
`status`, being a string of the hex value of the status
                  </li>
                  <li id="message">
`message`, being a string containing the associated message
                  </li>
                </ul>
Implementers MAY add additional values to objects in the `statusMessage` array.
Implementers MAY use the string value of `undefined` in the value to indicate
that a corresponding status is not defined for the associated status value, but
that it may be defined in the future. Rules for how to handle various status
messages are outside the scope of normative requirements in this document, but
it is assumed that implementers will document rules for processing various
status codes.
              </td>
            </tr>
            <tr>
              <td id="statusReference">credentialSubject.statusReference</td>
              <td>
The `statusReference` property provides a point for implementers to include a
[[URL]] to material related to the status. An implementer MAY include the
`statusReference` property, and if they do, the value MUST be a [[URL]] or an
array of URLs. Implementers using a `statusPurpose` of `status` are strongly
encouraged to provide a `statusReference`.
                <p class="note" title="Details around reference">
`statusReference` is especially important when interpretation of the status for
a credential may involve some understanding of the business case involved.
                </p>
              </td>
            </tr>
          </tbody>
        </table>

        <pre class="example nohighlight" title="Example BitstringStatusListCredential">
{
  "@context": [
    "https://www.w3.org/ns/credentials/v2"
  ],
  "id": "<span class="highlight">https://example.com/credentials/status/3</span>",
  "type": ["VerifiableCredential", "<span class="highlight">BitstringStatusListCredential</span>"],
  "issuer": "did:example:12345",
  "validFrom": "2021-04-05T14:27:40Z",
  "credentialSubject": {
    "id": "https://example.com/status/3#list",
    "type": "<span class="highlight">BitstringStatusList</span>",
    "statusPurpose": "<span class="highlight">revocation</span>",
    "encodedList": "<span class="highlight">H4sIAAAAAAAAA-3BMQEAAADCoPVPbQwfoAAAAAAAAAAAAAAAAAAAAIC3AYbSVKsAQAAA</span>"
  },
  "proof": { ... }
}
        </pre>
        <p class="issue" data-number="73" title="Design of multiple status messages is not finalized.">
The Working Group is still discussing the unification of a design between status
lists with a single state (such as "revoked" or "suspended") and status lists
with multiple states (exposed via a series of status messages). We are seeking
implementer feedback on what a unified design should look like from an ease of
implementation, privacy, and security standpoint.
        </p>
        <pre class="example nohighlight" title="Example BitstringStatusListCredential">
{
  "@context": [
    "https://www.w3.org/ns/credentials/v2"
  ],
  "id": "<span class="highlight">https://example.com/credentials/status/3</span>",
  "type": ["VerifiableCredential", "<span class="highlight">BitstringStatusListCredential</span>"],
  "issuer": "did:example:12345",
  "validFrom": "2021-04-05T14:27:40Z",
  "credentialSubject": {
    "id": "https://example.com/status/3#list",
    "type": "<span class="highlight">BitstringStatusList</span>",
    "ttl": 500,
    "statusPurpose": "<span class="highlight">status</span>",
    "reference": "https://example.org/status-dictionary/",
    "size": 2,
    "statusMessage": [
        {"status":"0x0", "message":"valid"},
        {"status":"0x1", "message":"invalid"},
        {"status":"0x2", "message":"pending_review"},
        ...
    ],
    "encodedList": "H4sIAAAAAAAAA-3BMQEAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAIC3AYbSVKsAQAAA"
  }
}
        </pre>
      </section>

    </section>

  <section class="normative">
    <h2>Algorithms</h2>

    <p>
The following section outlines the algorithms that are used to generate
and validate status lists as described by this document.
    </p>

    <p>
If an implementation of any of the algorithms in this section processes a property
defined in Section <a href="#data-model"></a> whose value is malformed due to
not complying with associated "MUST" statements, a
<a data-cite="VC-DATA-MODEL-2.0#MALFORMED_VALUE_ERROR">MALFORMED_VALUE_ERROR</a>
MUST be raised.
    </p>

    <section class="normative">
      <h3>Generate Algorithm</h3>

      <p>
The following process, or one generating the exact output, MUST be followed
when producing a
<a href="#bitstringstatuslistcredential">BitstringStatusListCredential</a>:
      </p>

      <ol class="algorithm">
        <li>
Let |issued credentials| be a list of all issued
<a>verifiable credentials</a>.
        </li>
        <li>
Let |RLC| be an unsigned
<a href="#bitstringstatuslistcredential">BitstringStatusListCredential</a>
without the `encodedList` property set.
        </li>
        <li>
Generate a |compressed bitstring| by passing
|issued credentials| to the
<a href="#bitstring-generation-algorithm">Bitstring Generation Algorithm</a>.
        </li>
        <li>
Set the `encodedList` to |compressed bitstring|.
        </li>
        <li>
Generate a proof for the |RLC| and publish it to the
endpoint listed in the <a>verifiable credential</a>.
        </li>
      </ol>
    </section>

    <section class="normative">
      <h3>Validate Algorithm</h3>

      <p>
The following process, or one generating the exact output, MUST be followed
when validating a <a>verifiable credential</a> that is contained in a
<a href="#bitstringstatuslistcredential">BitstringStatusListCredential</a>:
      </p>

      <ol class="algorithm">
        <li>
Let |credentialToValidate| be a <a>verifiable credential</a>
containing a `credentialStatus` entry that is a
<a href="#bitstringstatuslistentry">BitstringStatusListEntry</a>.
        </li>
        <li>
Let |minimumNumberOfEntries| be 131,072 unless a different lower bound is
established by a specific ecosystem specification.
        </li>
        <li>
Let |status purpose| be the value of `statusPurpose`
in the `credentialStatus` entry in the
|credentialToValidate|.
        </li>
        <li>
Dereference the `statusListCredential` URL, and ensure that all
proofs verify successfully. If the dereference fails, raise a
<a href="#STATUS_RETRIEVAL_ERROR">STATUS_RETRIEVAL_ERROR</a>. If any of the
proof verifications fail, raise a
<a href="#STATUS_VERIFICATION_ERROR">STATUS_VERIFICATION_ERROR</a>.
        </li>
        <li>
Verify that the |status purpose| is equal to the
`statusPurpose` value in the |statusListCredential|. If the values are not
equal, raise a
<a href="#STATUS_VERIFICATION_ERROR">STATUS_VERIFICATION_ERROR</a>.
        </li>
        <li>
Let |compressed bitstring| be the value of the
`encodedList` property of the
<a href="#bitstringstatuslistcredential">BitstringStatusListCredential</a>.
        </li>
        <li>
Let |credentialIndex| be the value of the
`statusListIndex` property of the
<a href="#bitstringstatuslistentry">BitstringStatusListEntry</a>.
        </li>
        <li>
Generate a |revocation bitstring| by passing
|compressed bitstring| to the
<a href="#bitstring-expansion-algorithm">Bitstring Expansion Algorithm</a>.
        </li>
        <li>
If the length of the |revocation bitstring| divided by
<a href="#statusSize">`statusSize`</a> is less than |minimumNumberOfEntries|,
raise a <a href="#STATUS_LIST_LENGTH_ERROR">STATUS_LIST_LENGTH_ERROR</a>.
        </li>
        <li>
Let |status| be the value in the |bitstring| at the position indicated
by the |credentialIndex| multiplied by the |size|. If the |credentialIndex|
multiplied by the |size| is a value outside of the range of the |bitstring|, a
<a data-cite="VC-DATA-MODEL-2.0#RANGE_ERROR">RANGE_ERROR</a> MUST be
raised.
        </li>
        <li>
Let |result| be an empty [=map=].
        </li>
        <li>
Set the `status` key in |result| to |status|, and set the `purpose` key in
|result| to the value of `statusPurpose`.
        </li>
        <li>
If |status| is `0`, set the `valid` key in |result| to `true`; otherwise, set it
to `false`.
        </li>
        <li>
If the `statusPurpose` is `message`, set the `message` key in |result| to the
corresponding `message` of the `value` as indicated in the `statusMessages`
array.
        </li>
        <li>
Return |result|.
        </li>
      </ol>

      <p>
When a `statusListCredential` URL is dereferenced, server implementations MAY
provide a mechanism to dereference the status list as of a particular point in
time. When an <a>issuer</a> provides such a mechanism, it enables a
<a>verifier</a> to determine changes in status to a precision chosen by the
issuer, such as hourly, daily, or weekly. If such a feature is supported, and if
query parameters are supported by the URL scheme, then the name of the query
parameter MUST be `timestamp` and the value MUST be a valid URL-encoded
[[XMLSCHEMA11-2]] dateTimeStamp string value. The result of dereferencing such a
timestamp-parameterized URL MUST be either a status list credential containing
the status list as it existed at the given point in time, or a
<a href="#STATUS_RETRIEVAL_ERROR">STATUS_RETRIEVAL_ERROR</a>. If the result is
an error, implementations MAY attempt the retrieval again with a different
timestamp value, or without a timestamp value, as long as the <a>verifier</a>'s
validation rules permit such an action.
      </p>

      <p class="note" title="Issuer validation is use case dependent">
It is expected that a <a>verifier</a> will ensure that it trusts the issuer
of a <a>verifiable credential</a>, as well as the issuer of the associated
<a href="#bitstringstatuslistcredential">BitstringStatusListCredential</a>,
before using the information contained in either credential for further
decision making purposes. Implementers are advised that the issuers of these
credential might differ, such as when the original issuer of the
<a>verifiable credential</a> does not maintain a record of its validity.
      </p>

    </section>

    <section class="normative">
      <h3>Bitstring Generation Algorithm</h3>
      <p>
The following process, or one generating the exact output, MUST be followed
when generating a status list bitstring. The algorithm takes a
|issuedCredentials| list as input and returns a
|compressed bitstring| as output.
      </p>

      <ol class="algorithm">
        <li>
Let |bitstring| be a list of bits with a minimum size of 16KB,
where each bit is initialized to 0 (zero).
        </li>
        <li>
For each value in `bitstring`, if there is a
corresponding `statusListIndex` value in
a credential in `issuedCredentials`, set the value to the
appropriate status. The position of the value is computed as `statusListIndex`
times the `statusSize`.
        </li>
        <li>
Generate a |compressed bitstring| by using the GZIP
compression algorithm [[RFC1952]] on the |bitstring|
and then base64url-encoding (with no padding) [[RFC4648]] the result.
        </li>
        <li>
Return the |compressed bitstring|.
        </li>
      </ol>
    </section>

    <section class="normative">
      <h3>Bitstring Expansion Algorithm</h3>

      <p>
The following process, or one generating the exact output, MUST be followed
when expanding a compressed status list bitstring. The algorithm takes a
|compressed bitstring| as input and returns a
|uncompressed bitstring| as output.
      </p>

      <ol class="algorithm">
        <li>
Let |compressed bitstring| be a compressed status list
bitstring.
        </li>
        <li>
Generate an |uncompressed bitstring| by using the
base64url-decoding (with no padding) [[RFC4648]] algorithm on the
|compressed bitstring| and then expanding the output using
the GZIP decompression algorithm [[RFC1952]].
        </li>
        <li>
Return the |uncompressed bitstring|.
        </li>
      </ol>
    </section>

    <section class="normative">
      <h3>Processing Errors</h3>

      <p>
The algorithms described in this specification throw specific types of errors.
Implementers might find it useful to convey these errors to other libraries or
software systems. This section provides specific URLs, descriptions, and error
codes for the errors, such that an ecosystem implementing technologies described
by this specification might interoperate more effectively when errors occur.
      </p>

      <p>
When exposing these errors through an HTTP interface, implementers SHOULD use
[[RFC9457]] to encode the error data structure. If [[RFC9457]] is used:
      </p>

      <ul>
        <li>
The `type` value of the error object MUST be a URL that starts with the value
`https://www.w3.org/ns/credentials/status-list#` and ends with the value in the
section listed below.
        </li>
        <li>
The `code` value MUST be the integer code described in the table below
(in parentheses, beside the type name).
        </li>
        <li>
The `title` value SHOULD provide a short but specific human-readable string for
the error.
        </li>
        <li>
The `detail` value SHOULD provide a longer human-readable string for the error.
        </li>
      </ul>

      <dl>
        <dt id="STATUS_RETRIEVAL_ERROR">
STATUS_RETRIEVAL_ERROR (-128)
        </dt>
        <dd>
Retrieval of the status list failed. See Section
<a href="#validate-algorithm"></a>.
        </dd>
        <dt id="STATUS_VERIFICATION_ERROR">STATUS_VERIFICATION_ERROR (-129)</dt>
        <dd>
Validation of the status entry failed. See Section
<a href="#validate-algorithm"></a>.
        </dd>
        <dt id="STATUS_LIST_LENGTH_ERROR">
STATUS_LIST_LENGTH_ERROR (-130)
        </dt>
        <dd>
The status list length does not satisfy the minimum length required for
herd privacy. See Section <a href="#validate-algorithm"></a>.
        </dd>
      </dl>
    </section>
  </section>

  <section class="normative">
    <h2>Media Types</h2>

    <p>
<a>Issuers</a> SHOULD publish status list information
using HTTPS URLs and in ways that minimize possible correlation of usage
patterns related to the list. <a>Verifiers</a>
SHOULD retrieve status list information using protocols that guard against access
pattern correlation, such as Oblivious HTTP [[?OHTTP]].
    </p>

    <p>
When dereferencing `statusListCredential`, the content of the returned
`statusListCredential` might be any media type registered for the purpose of
expressing a verifiable credential with one or more proofs.
    </p>
    <p>
For example, a verifiable credential secured with Data Integrity Proofs might
have media type `application/vc+ld+json`, while a verifiable credential
secured with SD-JWT might have media type `application/sd-jwt`.
    </p>
    <p>
Some implementations might choose to support less specific media types such as
`application/ld+json` or `application/json`.
    </p>
    <p>
When dereferencing over HTTP, the use of the <a
data-cite="rfc7231#section-5.3.2">accept</a>
and <a data-cite="rfc7231#section-3.1.1.5">content-type</a> headers, might allow
some implementations to negotiate for the proof format used to secure the
`statusListCredential`.
    </p>
    <p>
Some implementations might use the <a data-cite="rfc7231#section-6.5.13">415
Unsupported Media Type</a> status code to signal that they do not support the
requested media type.
    </p>
  </section>

  <section class="informative">
    <h2>Privacy Considerations</h2>

    <p>
This section details the general privacy considerations and specific privacy
implications of deploying this specification into production environments.
    </p>

    <section class="informative">
      <h3>Revocation Bitstring Length</h3>

      <p>
This document specifies a minimum revocation bitstring length of 131,072, or
16KB uncompressed. This is enough to give <a>holders</a> an adequate amount of
herd privacy if the number of verifiable credentials issued is large enough.
However, if the number of issued verifiable credentials is a small population,
the ability to correlate an individual increases because the number of allocated
slots in the bitstring is small. Correlating this information with, for example,
where the geographic request came from can also help to correlate individuals
that have received a credential from the same geographic region.
      </p>
    </section>

    <section class="informative">
      <h3>Verifier Caching</h3>

      <p>
It is possible for <a>verifiers</a> to increase the privacy of the
<a>holder</a> whose <a>verifiable credential</a> is being checked by caching
status lists that have been fetched from remote servers. By caching the
content locally, less correlatable information can be inferred from
<a>verifier</a>-based access patterns on the status list.
      </p>
    </section>

    <section class="informative">
      <h3>Content Distribution Networks</h3>

      <p>
The use of content distribution networks by <a>issuers</a> can increase the
privacy of <a>holders</a> by reducing or eliminating requests for the
status lists from the <a>issuer</a>. Often, a request for a revocation
list will be served by an edge device and thus be faster and reduce the load
on the server as well as cloaking <a>verifiers</a> and <a>holders</a>
from <a>issuers</a>.
      </p>
    </section>

    <section class="informative">
      <h3>Malicious Issuers and Verifiers</h3>
      <p>
In general, the herd privacy protections offered by this specification can be
circumvented by malicious <a>issuers</a> and <a>verifiers</a>. Its privacy
benefits can only be realized when issuers and verifiers intend to avoid
tracking or sharing the presentation of particular credentials.
      </p>
      <p>
A malicious <a>issuer</a> might intentionally attack herd privacy by creating a
unique status list per credential issued in order to establish a 1-1 mapping to track
when a <a>verifier</a> processes a specific credential. Similarly, they could establish
another a 1-1 mapping by using a different cryptographic key for every credential
issued that is tracked in a status list.
      </p>
      <p>
A malicious <a>verifier</a> might intentionally attack herd privacy by sharing
information from presented credentials with a malicious <a>issuer</a>.
      </p>
    </section>

  </section>

  <section class="informative">
    <h2>Security Considerations</h2>

    <p>
There are a number of security considerations that implementers should be
aware of when processing data described by this specification. Ignoring or
not understanding the implications of this section can result in
security vulnerabilities.
    </p>

    <p>
While this section attempts to highlight a broad set of security
considerations, it is not a complete list. Implementers are urged to seek the
advice of security and cryptography professionals when implementing mission
critical systems using the technology outlined in this specification.
    </p>

    <section class="informative">
      <h3>Bitstring Encoding</h3>

      <p>
It is critical that implementers pay particular attention to the way that they
encode and decode bitstrings. Failure to do so can result in checking the
wrong bitstring index for a given credential, leading to a misinterpretation
of its present state (e.g., mistaking a revoked status for an unrevoked
status). As stated in Section <a href="#bitstringstatuslistcredential"></a>,
bitstrings are encoded such that the first (zeroth) index refers to the
left-most bit of the bitstring array. The diagram below demonstrates the
proper layout for an uncompressed bitstring.
      </p>

      <figure id="bitstring-layout">
        <img style="margin: auto; display: block; width: 75%;"
             src="diagrams/bitstring-layout.svg" alt="a diagram showing two
             wide rectangles shown side-by-side. Each rectangle is partitioned
             into eight boxes to represent the 8 bits in a byte. The left
             rectangle is labeled 'First byte' and the right rectangle is
             labeled 'Last byte'. The left rectangle's left-most bit box is
             pointed to by an arrow labeled 'index: 0'. The right rectangle's
             right-most bit box is pointed to by an arrow labeled
             'index: length - 1'.">
        <figcaption style="text-align: center;">
          A visual depiction of the bitstring layout.
        </figcaption>
      </figure>

      <p>
For example, if a bitstring is 131,072 bits in size (16KB), the first index will
be 0, and the last index will be 131,071.
      </p>
      <p>
Implementations SHOULD consume and/or assign indexes randomly.
      </p>
    </section>

  </section>

  <section class="informative">
    <h2>Accessibility Considerations</h2>

    <p>
There are a number of accessibility considerations implementers should be
aware of when processing data described in this specification. As with any web
standards or protocols implementation, ignoring accessibility issues makes
this information unusable to a large subset of the population. It is important
to follow accessibility guidelines and standards, such as [[WCAG21]], to ensure
all people, regardless of ability, can make use of this data. This is
especially important when establishing systems utilizing cryptography, which
have historically created problems for assistive technologies.
    </p>

    <p>
This section details the general accessibility considerations to take into
account when utilizing this data model.
    </p>

    <p class="issue">
Write accessibility considerations.
    </p>

  </section>

  <section class="informative">
    <h2>Internationalization Considerations</h2>

    <p>
There are a number of internationalization considerations implementers should be
aware of when publishing data described in this specification. As with any web
standards or protocols implementation, ignoring internationalization makes it
difficult for data to be produced and consumed across a disparate set of
languages and societies, which would limit the applicability of the
specification and significantly diminish its value as a standard.
    </p>

    <p>
This section outlines general internationalization considerations to take into
account when utilizing this data model.
    </p>

    <p class="issue">
Write i18n considerations.
    </p>

  </section>

  <section class="informative">
    <h2>Appendix</h2>
    <section>
      <h2>Examples</h2>
      <section>
        <h2>Revocable Verifiable Credential</h2>
<pre class="example nohighlight vc" title="A Revocable Verifiable Credential"
data-vc-vm='https://example.edu/issuers/565049/keys/1'>
{
  "@context": [
    "https://www.w3.org/ns/credentials/v2",
    "https://www.w3.org/ns/credentials/examples/v2"
  ],
  "id": "https://example.com/credentials/23894672394",
  "type": ["VerifiableCredential"],
  "issuer": "did:example:12345",
  "validFrom": "2021-04-05T14:27:42Z",
  <span class="highlight">"credentialStatus": {
    "id": "https://example.com/credentials/status/3#94567",
    "type": "BitstringStatusListEntry",
    "statusPurpose": "revocation",
    "statusListIndex": "94567",
    "statusListCredential": "https://example.com/credentials/status/3"
  }</span>,
  "credentialSubject": {
    "id": "did:example:6789",
    "type": "Person"
  }
}
</pre>

      </section>
      <section>
        <h2>Status List Verifiable Credential</h2>
<pre class="example nohighlight vc" title="A Status List Verifiable Credential"
data-vc-vm='https://example.edu/issuers/565049/keys/1'>
{
  "@context": [
    "https://www.w3.org/ns/credentials/v2",
    "https://www.w3.org/ns/credentials/examples/v2"
  ],
  "id": "<span class="highlight">https://example.com/credentials/status/3</span>",
  "type": ["VerifiableCredential", "<span class="highlight">BitstringStatusListCredential</span>"],
  "issuer": "did:example:12345",
  "validFrom": "2021-04-05T14:27:40Z",
  "credentialSubject": {
    "id": "https://example.com/status/3#list",
    "type": "<span class="highlight">BitstringStatusList</span>",
    "statusPurpose": "<span class="highlight">revocation</span>",
    "encodedList": "<span class="highlight">H4sIAAAAAAAAA-3BMQEAAADCoPVPbQwfoAAAAAAAAAAAAAAAAAAAAIC3AYbSVKsAQAAA</span>"
  }
}
</pre>
      </section>
    </section>
  </section>

  </body>
</html>
